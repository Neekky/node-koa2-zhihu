(()=>{var e={432:(e,t,r)=>{var n=r(307),s=r(591),i=new(r(406)),a=r(783),o=r(105),c=r(551),u=r(4).koaBody,p=r(97),d=r(964),l=r(889),f=r(529),y=r(56),w=r(25),m=r(104),g=r(83),v=r(211),x=r(616),b=r(17),k=r(185),h=r(326).connectionStr;k.connect(h,(function(){console.log("MongoDB连接成功！")})),k.connection.on("error",console.error),i.use(p(b.join("","uploadImg"))),c(i),i.use(u({multipart:!0,formidable:{uploadDir:b.join("","/uploadImg"),keepExtensions:!0,onError:function(e){console.log(e)}}})),i.use(o()),i.use(d()),i.use(r(97)("/public")),i.use(a("/views",{extension:"pug"})),i.use(function(){var e=s(n.mark((function e(t,r){var s,i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=new Date,e.next=3,r();case 3:i=new Date-s,console.log("".concat(t.method," ").concat(t.url," - ").concat(i,"ms"));case 5:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()),i.use(l(i)),i.use(f.routes(),f.allowedMethods()),i.use(y.routes(),y.allowedMethods()),i.use(w.routes(),w.allowedMethods()),i.use(m.routes(),m.allowedMethods()),i.use(g.routes(),g.allowedMethods()),i.use(v.routes(),v.allowedMethods()),i.use(x.routes(),x.allowedMethods()),i.on("error",(function(e,t){console.error("server error",e,t)})),e.exports=i},326:e=>{e.exports={secret:"JUS865S&HSYTQI9653",connectionStr:"mongodb+srv://475383200:mmissyou...12@cluster0.tzpc8fh.mongodb.net/?retryWrites=true&w=majority"}},94:(e,t,r)=>{var n=r(779),s=r(307),i=r(591),a=r(537),o=r(765);function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var p=r(788),d=r(940),l=d.SuccessModel,f=d.ErrorModel,y=100010,w=function(){"use strict";function e(){a(this,e)}var t,r,n,c,d,w,m;return o(e,[{key:"find",value:(m=i(s.mark((function e(t){var r,n,i,a,o,c,u,d;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.query,n=r.per_page,i=void 0===n?10:n,a=r.q,o=Math.max(1*t.query.page,1)-1,c=Math.max(1*i,1),u=new RegExp(a),e.next=6,p.find({content:u,questionId:t.params.questionId}).limit(c).skip(o*c);case 6:d=e.sent,t.body=new l({data:d});case 8:case"end":return e.stop()}}),e)}))),function(e){return m.apply(this,arguments)})},{key:"findById",value:(w=i(s.mark((function e(t){var r,n,i;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.query.fields,n=(void 0===r?"":r).split(";").filter((function(e){return e})).map((function(e){return" +"+e})).join(""),e.next=4,p.findById(t.params.id).select(n).populate("answerer");case 4:if(i=e.sent){e.next=8;break}return t.body=new f({data:i,msg:"答案不存在",code:y}),e.abrupt("return");case 8:t.body=new l({data:i,msg:"查找答案成功"});case 9:case"end":return e.stop()}}),e)}))),function(e){return w.apply(this,arguments)})},{key:"create",value:(d=i(s.mark((function e(t){var r;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.verifyParams({content:{type:"string",required:!0}}),e.next=3,new p(u(u({},t.request.body),{},{answerer:t.state.user._id,questionId:t.params.questionId})).save();case 3:r=e.sent,t.body=new l({data:r,msg:"回答成功"});case 5:case"end":return e.stop()}}),e)}))),function(e){return d.apply(this,arguments)})},{key:"update",value:(c=i(s.mark((function e(t){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.verifyParams({content:{type:"string",required:!1}}),e.next=3,t.state.answer.update(t.request.body);case 3:t.body=new l({data:t.state.answer,msg:"更新回答成功"});case 4:case"end":return e.stop()}}),e)}))),function(e){return c.apply(this,arguments)})},{key:"checkAnswerExist",value:(n=i(s.mark((function e(t,r){var n;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.findById(t.params.id).select("+answerer");case 2:if(n=e.sent){e.next=6;break}return t.body=new f({msg:"该答案不存在",code:10020404}),e.abrupt("return");case 6:if(!t.params.questionId||n.questionId===t.params.questionId){e.next=9;break}return t.body=new f({msg:"该问题下没有此答案",code:10020404}),e.abrupt("return");case 9:return t.state.answer=n,e.next=12,r();case 12:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})},{key:"checkAnswerer",value:(r=i(s.mark((function e(t,r){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.state.answer.answerer.toString()===t.state.user._id){e.next=3;break}return t.body=new f({msg:"该用户没有权限",code:10020403}),e.abrupt("return");case 3:return e.next=5,r();case 5:case"end":return e.stop()}}),e)}))),function(e,t){return r.apply(this,arguments)})},{key:"delete",value:(t=i(s.mark((function e(t){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.findByIdAndRemove(t.params.id);case 2:t.body=new l({msg:"删除成功",code:204});case 3:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),e}();e.exports=new w},365:(e,t,r)=>{var n=r(779),s=r(307),i=r(591),a=r(537),o=r(765);function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var p=r(834),d=r(940),l=d.SuccessModel,f=d.ErrorModel,y=100010,w=function(){"use strict";function e(){a(this,e)}var t,r,n,c,d,w,m;return o(e,[{key:"find",value:(m=i(s.mark((function e(t){var r,n,i,a,o,c,u,d,f,y,w,m;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.query,n=r.per_page,i=void 0===n?10:n,a=r.q,o=Math.max(1*t.query.page,1)-1,c=Math.max(1*i,1),u=new RegExp(a),d=t.params,f=d.questionId,y=d.answerId,w=t.query.rootCommentId,e.next=8,p.find({content:u,questionId:f,answerId:y,rootCommentId:w}).limit(c).skip(o*c).populate("commentator replyTo");case 8:m=e.sent,t.body=new l({data:m});case 10:case"end":return e.stop()}}),e)}))),function(e){return m.apply(this,arguments)})},{key:"findById",value:(w=i(s.mark((function e(t){var r,n,i;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.query.fields,n=(void 0===r?"":r).split(";").filter((function(e){return e})).map((function(e){return" +"+e})).join(""),e.next=4,p.findById(t.params.id).select(n).populate("commentator");case 4:if(i=e.sent){e.next=8;break}return t.body=new f({data:i,msg:"答案不存在",code:y}),e.abrupt("return");case 8:t.body=new l({data:i,msg:"查找答案成功"});case 9:case"end":return e.stop()}}),e)}))),function(e){return w.apply(this,arguments)})},{key:"create",value:(d=i(s.mark((function e(t){var r,n,i,a;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.verifyParams({content:{type:"string",required:!0},rootCommentId:{type:"string",required:!1},replyTo:{type:"string",required:!1}}),r=t.params,n=r.questionId,i=r.answerId,e.next=4,new p(u(u({},t.request.body),{},{commentator:t.state.user._id,questionId:n,answerId:i})).save();case 4:a=e.sent,t.body=new l({data:a,msg:"评论成功"});case 6:case"end":return e.stop()}}),e)}))),function(e){return d.apply(this,arguments)})},{key:"update",value:(c=i(s.mark((function e(t){var r;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.verifyParams({content:{type:"string",required:!1}}),r=t.request.body.content,e.next=4,t.state.comment.update({content:r});case 4:t.body=new l({data:t.state.comment,msg:"更新评论成功"});case 5:case"end":return e.stop()}}),e)}))),function(e){return c.apply(this,arguments)})},{key:"checkCommentExist",value:(n=i(s.mark((function e(t,r){var n;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.findById(t.params.id).select("+commentator");case 2:if(n=e.sent){e.next=6;break}return t.body=new f({msg:"该评论不存在",code:1002401}),e.abrupt("return");case 6:if(!t.params.questionId||n.questionId===t.params.questionId){e.next=9;break}return t.body=new f({msg:"该问题下没有此评论",code:10020404}),e.abrupt("return");case 9:if(!t.params.answerId||n.answerId===t.params.answerId){e.next=12;break}return t.body=new f({msg:"该答案下没有此评论",code:10020408}),e.abrupt("return");case 12:return t.state.comment=n,e.next=15,r();case 15:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})},{key:"checkCommentator",value:(r=i(s.mark((function e(t,r){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.state.comment.commentator.toString()===t.state.user._id){e.next=3;break}return t.body=new f({msg:"该用户没有权限",code:10020403}),e.abrupt("return");case 3:return e.next=5,r();case 5:case"end":return e.stop()}}),e)}))),function(e,t){return r.apply(this,arguments)})},{key:"delete",value:(t=i(s.mark((function e(t){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.findByIdAndRemove(t.params.id);case 2:t.body=new l({msg:"删除成功",code:204});case 3:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),e}();e.exports=new w},334:(e,t,r)=>{var n=r(537),s=r(765),i=function(){"use strict";function e(){n(this,e)}return s(e,[{key:"upload",value:function(e){console.log(e.request.files,"ctx.request.files is");var t=e.request.files.file;e.body={url:"".concat(e.origin,"/").concat(t.newFilename)}}}]),e}();e.exports=new i},764:(e,t,r)=>{var n=r(779),s=r(307),i=r(591),a=r(537),o=r(765);function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var p=r(864),d=(r(67),r(940)),l=d.SuccessModel,f=d.ErrorModel,y=100010,w=function(){"use strict";function e(){a(this,e)}var t,r,n,c,d,w,m;return o(e,[{key:"find",value:(m=i(s.mark((function e(t){var r,n,i,a,o,c,u,d;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.query,n=r.per_page,i=void 0===n?10:n,a=r.q,o=Math.max(1*t.query.page,1)-1,c=Math.max(1*i,1),u=new RegExp(a),e.next=6,p.find({$or:[{title:u},{description:u}]}).limit(c).skip(o*c);case 6:d=e.sent,t.body=new l({data:d});case 8:case"end":return e.stop()}}),e)}))),function(e){return m.apply(this,arguments)})},{key:"findById",value:(w=i(s.mark((function e(t){var r,n,i;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.query.fields,n=(void 0===r?"":r).split(";").filter((function(e){return e})).map((function(e){return" +"+e})).join(""),e.next=4,p.findById(t.params.id).select(n).populate("questioner topics");case 4:if(i=e.sent){e.next=8;break}return t.body=new f({data:i,msg:"问题不存在",code:y}),e.abrupt("return");case 8:t.body=new l({data:i,msg:"查找成功"});case 9:case"end":return e.stop()}}),e)}))),function(e){return w.apply(this,arguments)})},{key:"create",value:(d=i(s.mark((function e(t){var r;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.verifyParams({title:{type:"string",required:!0},description:{type:"string",required:!1}}),e.next=3,new p(u(u({},t.request.body),{},{questioner:t.state.user._id})).save();case 3:r=e.sent,t.body=new l({data:r,msg:"创建话题成功"});case 5:case"end":return e.stop()}}),e)}))),function(e){return d.apply(this,arguments)})},{key:"update",value:(c=i(s.mark((function e(t){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.verifyParams({title:{type:"string",required:!1},description:{type:"string",required:!1}}),e.next=3,t.state.question.update(t.request.body);case 3:t.body=new l({data:t.state.question,msg:"更新问题成功"});case 4:case"end":return e.stop()}}),e)}))),function(e){return c.apply(this,arguments)})},{key:"checkQuestionExist",value:(n=i(s.mark((function e(t,r){var n;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.findById(t.params.id).select("+questioner");case 2:if(n=e.sent){e.next=6;break}return t.body=new f({msg:"该问题不存在",code:10020404}),e.abrupt("return");case 6:return t.state.question=n,e.next=9,r();case 9:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})},{key:"checkQuestioner",value:(r=i(s.mark((function e(t,r){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.state.question.questioner.toString()===t.state.user._id){e.next=3;break}return t.body=new f({msg:"该用户没有权限",code:10020403}),e.abrupt("return");case 3:return e.next=5,r();case 5:case"end":return e.stop()}}),e)}))),function(e,t){return r.apply(this,arguments)})},{key:"delete",value:(t=i(s.mark((function e(t){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.findByIdAndRemove(t.params.id);case 2:t.body=new l({msg:"删除成功",code:204});case 3:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),e}();e.exports=new w},997:(e,t,r)=>{var n=r(307),s=r(591),i=r(537),a=r(765),o=r(323),c=r(67),u=r(864),p=r(940),d=p.SuccessModel,l=p.ErrorModel,f=100010,y=100401,w=function(){"use strict";function e(){i(this,e)}var t,r,p,w,m,g,v;return a(e,[{key:"find",value:(v=s(n.mark((function e(t){var r,s,i,a,c,u,p;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.query,s=r.per_page,i=void 0===s?10:s,a=r.q,c=Math.max(1*t.query.page,1)-1,u=Math.max(1*i,1),e.next=5,o.find({name:new RegExp(a)}).limit(u).skip(c*u);case 5:p=e.sent,t.body=new d({data:p});case 7:case"end":return e.stop()}}),e)}))),function(e){return v.apply(this,arguments)})},{key:"findById",value:(g=s(n.mark((function e(t){var r,s,i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.query.fields,s=(void 0===r?"":r).split(";").filter((function(e){return e})).map((function(e){return" +"+e})).join(""),e.next=4,o.findById(t.params.id).select(s);case 4:if(i=e.sent){e.next=8;break}return t.body=new l({data:i,msg:"话题不存在",code:f}),e.abrupt("return");case 8:t.body=new d({data:i,msg:"查找成功"});case 9:case"end":return e.stop()}}),e)}))),function(e){return g.apply(this,arguments)})},{key:"create",value:(m=s(n.mark((function e(t){var r;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.verifyParams({name:{type:"string",required:!0},avatar_url:{type:"string",required:!1},introduction:{type:"string",required:!1}}),e.next=3,new o(t.request.body).save();case 3:r=e.sent,t.body=new d({data:r,msg:"创建话题成功"});case 5:case"end":return e.stop()}}),e)}))),function(e){return m.apply(this,arguments)})},{key:"update",value:(w=s(n.mark((function e(t){var r;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.verifyParams({name:{type:"string",required:!1},avatar_url:{type:"string",required:!1},introduction:{type:"string",required:!1}}),e.next=3,o.findByIdAndUpdate(t.params.id,t.request.body);case 3:r=e.sent,t.body=new d({data:r,msg:"更新话题成功"});case 5:case"end":return e.stop()}}),e)}))),function(e){return w.apply(this,arguments)})},{key:"checkTopicExist",value:(p=s(n.mark((function e(t,r){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.findById(t.params.id);case 2:if(e.sent){e.next=6;break}return t.body=new l({msg:"该话题不存在",code:10020404}),e.abrupt("return");case 6:return e.next=8,r();case 8:case"end":return e.stop()}}),e)}))),function(e,t){return p.apply(this,arguments)})},{key:"listTopicFollowers",value:(r=s(n.mark((function e(t){var r;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.find({followingTopics:t.params.id});case 2:if(!(r=e.sent)){e.next=6;break}return t.body=new d({data:r,msg:"查询成功",code:200}),e.abrupt("return");case 6:t.body=new l({msg:"查询失败",code:y});case 7:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"listQuestions",value:(t=s(n.mark((function e(t){var r;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.find({topics:t.params.id});case 2:if(!(r=e.sent)){e.next=6;break}return t.body=new d({data:r,msg:"查询成功",code:200}),e.abrupt("return");case 6:t.body=new l({msg:"查询失败",code:y});case 7:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),e}();e.exports=new w},226:(e,t,r)=>{var n=r(307),s=r(591),i=r(537),a=r(765),o=r(344),c=r(67),u=r(864),p=r(788),d=r(326).secret,l=r(940),f=l.SuccessModel,y=l.ErrorModel,w=100010,m=100409,g=100401,v=function(){"use strict";function e(){i(this,e)}var t,r,l,v,x,b,k,h,q,I,O,A,j,T,E,S,B,P,_,M,C,D,R,U,N;return a(e,[{key:"create",value:(N=s(n.mark((function e(t){var r,s;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.verifyParams({name:{type:"string",required:!0},password:{type:"string",required:!0}}),r=t.request.body.name,e.next=4,c.findOne({name:r});case 4:if(!e.sent){e.next=8;break}return t.body=new y({msg:"用户名已存在",code:m}),e.abrupt("return");case 8:return e.next=10,new c(t.request.body).save();case 10:s=e.sent,t.body=new f({data:s});case 12:case"end":return e.stop()}}),e)}))),function(e){return N.apply(this,arguments)})},{key:"find",value:(U=s(n.mark((function e(t){var r,s,i,a,o,u,p,d;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.query,s=r.per_page,i=void 0===s?10:s,a=r.page,o=r.q,u=Math.max(1*a,1)-1,p=Math.max(1*i,1),e.next=5,c.find({name:new RegExp(o)}).limit(p).skip(u*p);case 5:d=e.sent,t.body=new f({data:d});case 7:case"end":return e.stop()}}),e)}))),function(e){return U.apply(this,arguments)})},{key:"findById",value:(R=s(n.mark((function e(t){var r,s,i,a,o;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.query.fields,i=(s=void 0===r?"":r).split(";").filter((function(e){return e})).map((function(e){return" +"+e})).join(""),a=s.split(";").filter((function(e){return e})).map((function(e){return"employments"===e?"employments.company employments.job":"educations"===e?"educations.school educations.major":e})).join(" "),e.next=5,c.findById(t.params.id).select(i).populate(a);case 5:if(o=e.sent){e.next=9;break}return t.body=new y({data:o,msg:"用户不存在",code:w}),e.abrupt("return");case 9:t.body=new f({data:o,msg:"查找成功"});case 10:case"end":return e.stop()}}),e)}))),function(e){return R.apply(this,arguments)})},{key:"checkOwner",value:(D=s(n.mark((function e(t,r){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log(t.params.id,t.state.user._id," ctx.state.user._id is"),t.params.id===t.state.user._id){e.next=4;break}return t.body=new y({msg:"该用户没有权限",code:403,pid:t.params.id,sid:t.state.user._id}),e.abrupt("return");case 4:return e.next=6,r();case 6:case"end":return e.stop()}}),e)}))),function(e,t){return D.apply(this,arguments)})},{key:"update",value:(C=s(n.mark((function e(t){var r;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.verifyParams({name:{type:"string",required:!1},password:{type:"string",required:!1},avatar_url:{type:"string",required:!1},gender:{type:"string",required:!1},headline:{type:"string",required:!1},locations:{type:"array",itemType:"string",required:!1},business:{type:"string",required:!1},employments:{type:"array",itemType:"object",required:!1},educations:{type:"array",itemType:"object",required:!1},introduction:{type:"string",required:!1}}),e.next=3,c.findByIdAndUpdate(t.params.id,t.request.body);case 3:if(r=e.sent){e.next=7;break}return t.body=new y({data:r,msg:"用户不存在",code:w}),e.abrupt("return");case 7:t.body=new f({data:r,msg:"更新成功"});case 8:case"end":return e.stop()}}),e)}))),function(e){return C.apply(this,arguments)})},{key:"delete",value:(M=s(n.mark((function e(t){var r;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.verifyParams({id:{type:"string",required:!0}}),e.next=3,c.findByIdAndRemove(t.params.id);case 3:if(r=e.sent){e.next=7;break}return t.body=new y({data:r,msg:"用户不存在",code:w}),e.abrupt("return");case 7:t.body=new f({data:r,msg:"删除成功",code:204});case 8:case"end":return e.stop()}}),e)}))),function(e){return M.apply(this,arguments)})},{key:"login",value:(_=s(n.mark((function e(t){var r,s,i,a;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.verifyParams({name:{type:"string",required:!0},password:{type:"string",required:!0}}),e.next=3,c.findOne(t.request.body);case 3:if(r=e.sent){e.next=7;break}return t.body=new y({msg:"用户名或密码不正确",code:g}),e.abrupt("return");case 7:s=r._id,i=r.name,a=o.sign({_id:s,name:i},d,{expiresIn:"2d"}),t.body=new f({data:{token:a},msg:"登录成功",code:200});case 10:case"end":return e.stop()}}),e)}))),function(e){return _.apply(this,arguments)})},{key:"listFollowing",value:(P=s(n.mark((function e(t){var r;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,c.findById(t.params.id).select("+following").populate("following");case 3:if(r=e.sent){e.next=7;break}return t.body=new y({msg:"没有该用户",code:g}),e.abrupt("return");case 7:t.body=new f({data:r.following,msg:"查询成功",code:200}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),t.body=new y({msg:"查询失败",code:g});case 13:case"end":return e.stop()}}),e,null,[[0,10]])}))),function(e){return P.apply(this,arguments)})},{key:"listFollowers",value:(B=s(n.mark((function e(t){var r;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.find({following:t.params.id});case 2:r=e.sent,t.body=new f({data:r,msg:"查询成功",code:200});case 4:case"end":return e.stop()}}),e)}))),function(e){return B.apply(this,arguments)})},{key:"checkUserExist",value:(S=s(n.mark((function e(t,r){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.findById(t.params.id);case 2:if(e.sent){e.next=6;break}return t.body=new y({msg:"用户不存在",code:10020404}),e.abrupt("return");case 6:return e.next=8,r();case 8:case"end":return e.stop()}}),e)}))),function(e,t){return S.apply(this,arguments)})},{key:"follow",value:(E=s(n.mark((function e(t){var r,s;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.findById(t.state.user._id).select("+following");case 2:r=e.sent,s=t.params.id,r.following.map((function(e){return e.toString()})).includes(s)?t.body=new y({msg:"您已经关注该用户",code:g}):(r.following.push(s),r.save(),t.body=new f({msg:"关注成功",code:204}));case 5:case"end":return e.stop()}}),e)}))),function(e){return E.apply(this,arguments)})},{key:"unfollow",value:(T=s(n.mark((function e(t){var r,s,i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.findById(t.state.user._id).select("+following");case 2:r=e.sent,s=t.params.id,i=r.following.map((function(e){return e.toString()})).indexOf(s),i>-1?(r.following.splice(i,1),r.save(),t.body=new f({msg:"取消关注成功",code:204})):t.body=new y({msg:"您未关注该用户",code:g});case 6:case"end":return e.stop()}}),e)}))),function(e){return T.apply(this,arguments)})},{key:"listFollowingTopics",value:(j=s(n.mark((function e(t){var r;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,c.findById(t.params.id).select("+followingTopics").populate("followingTopics");case 3:if(r=e.sent){e.next=7;break}return t.body=new y({msg:"没有该话题",code:g}),e.abrupt("return");case 7:t.body=new f({data:r.followingTopics,msg:"查询成功",code:200}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),t.body=new y({msg:"查询失败",code:g,err:e.t0});case 13:case"end":return e.stop()}}),e,null,[[0,10]])}))),function(e){return j.apply(this,arguments)})},{key:"followTopic",value:(A=s(n.mark((function e(t){var r,s;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.findById(t.state.user._id).select("+followingTopics");case 2:r=e.sent,s=t.params.id,r.followingTopics.map((function(e){return e.toString()})).includes(s)?t.body=new y({msg:"您已经关注该话题",code:g}):(r.followingTopics.push(s),r.save(),t.body=new f({msg:"关注成功",code:204}));case 5:case"end":return e.stop()}}),e)}))),function(e){return A.apply(this,arguments)})},{key:"unfollowTopic",value:(O=s(n.mark((function e(t){var r,s,i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.findById(t.state.user._id).select("+followingTopics");case 2:r=e.sent,s=t.params.id,i=r.followingTopics.map((function(e){return e.toString()})).indexOf(s),i>-1?(r.followingTopics.splice(i,1),r.save(),t.body=new f({msg:"取消关注成功",code:204})):t.body=new y({msg:"您未关注该话题",code:g});case 6:case"end":return e.stop()}}),e)}))),function(e){return O.apply(this,arguments)})},{key:"listQuestions",value:(I=s(n.mark((function e(t){var r;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.find({questioner:t.params.id});case 2:r=e.sent,t.body=r?new f({data:r,msg:"查询成功",code:204}):new y({msg:"查询失败",code:g});case 4:case"end":return e.stop()}}),e)}))),function(e){return I.apply(this,arguments)})},{key:"listLikingAnswers",value:(q=s(n.mark((function e(t){var r;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,c.findById(t.params.id).select("+likingAnswers").populate("likingAnswers");case 3:if(r=e.sent){e.next=7;break}return t.body=new y({msg:"没有该用户",code:g}),e.abrupt("return");case 7:t.body=new f({data:r.likingAnswers,msg:"查询成功",code:200}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),t.body=new y({msg:"查询失败",code:g,err:e.t0});case 13:case"end":return e.stop()}}),e,null,[[0,10]])}))),function(e){return q.apply(this,arguments)})},{key:"likeAnswer",value:(h=s(n.mark((function e(t,r){var s,i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.findById(t.state.user._id).select("+likingAnswers");case 2:if(s=e.sent,i=t.params.id,s.likingAnswers.map((function(e){return e.toString()})).includes(i)){e.next=9;break}return s.likingAnswers.push(i),s.save(),e.next=9,p.findByIdAndUpdate(i,{$inc:{voteCount:1}});case 9:return e.next=11,r();case 11:case"end":return e.stop()}}),e)}))),function(e,t){return h.apply(this,arguments)})},{key:"unlikeAnswer",value:(k=s(n.mark((function e(t){var r,s,i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.findById(t.state.user._id).select("+likingAnswers");case 2:if(r=e.sent,s=t.params.id,i=r.likingAnswers.map((function(e){return e.toString()})).indexOf(s),!(i>-1)){e.next=10;break}return r.likingAnswers.splice(i,1),r.save(),e.next=10,p.findByIdAndUpdate(s,{$inc:{voteCount:-1}});case 10:t.body=new f({code:204});case 11:case"end":return e.stop()}}),e)}))),function(e){return k.apply(this,arguments)})},{key:"listDislikingAnswers",value:(b=s(n.mark((function e(t){var r;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,c.findById(t.params.id).select("+disLikingAnswers").populate("disLikingAnswers");case 3:if(r=e.sent){e.next=7;break}return t.body=new y({msg:"没有该用户",code:g}),e.abrupt("return");case 7:t.body=new f({data:r.disLikingAnswers,msg:"查询成功",code:200}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),t.body=new y({msg:"查询失败",code:g,err:e.t0});case 13:case"end":return e.stop()}}),e,null,[[0,10]])}))),function(e){return b.apply(this,arguments)})},{key:"dislikeAnswer",value:(x=s(n.mark((function e(t,r){var s,i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.findById(t.state.user._id).select("+disLikingAnswers");case 2:return s=e.sent,i=t.params.id,s.disLikingAnswers.map((function(e){return e.toString()})).includes(i)?t.body=new y({msg:"您已经踩该话题",code:g}):(s.disLikingAnswers.push(i),s.save(),t.body=new f({msg:"踩成功",code:200})),e.next=7,r();case 7:case"end":return e.stop()}}),e)}))),function(e,t){return x.apply(this,arguments)})},{key:"undislikeAnswer",value:(v=s(n.mark((function e(t){var r,s,i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.findById(t.state.user._id).select("+disLikingAnswers");case 2:r=e.sent,s=t.params.id,i=r.disLikingAnswers.map((function(e){return e.toString()})).indexOf(s),i>-1&&(r.disLikingAnswers.splice(i,1),r.save()),t.body=new f({code:204});case 7:case"end":return e.stop()}}),e)}))),function(e){return v.apply(this,arguments)})},{key:"listCollectingAnswers",value:(l=s(n.mark((function e(t){var r;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,c.findById(t.params.id).select("+collectingAnswers").populate("collectingAnswers");case 3:if(r=e.sent){e.next=7;break}return t.body=new y({msg:"没有该用户",code:g}),e.abrupt("return");case 7:t.body=new f({data:r.collectingAnswers,msg:"查询成功",code:200}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),t.body=new y({msg:"查询失败",code:g,err:e.t0});case 13:case"end":return e.stop()}}),e,null,[[0,10]])}))),function(e){return l.apply(this,arguments)})},{key:"collectAnswer",value:(r=s(n.mark((function e(t){var r,s;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.findById(t.state.user._id).select("+collectingAnswers");case 2:r=e.sent,s=t.params.id,r.collectingAnswers.map((function(e){return e.toString()})).includes(s)?t.body=new y({msg:"您已经收藏该答案",code:g}):(r.collectingAnswers.push(s),r.save(),t.body=new f({msg:"收藏成功",code:200}));case 5:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"uncollectAnswer",value:(t=s(n.mark((function e(t){var r,s,i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.findById(t.state.user._id).select("+collectingAnswers");case 2:r=e.sent,s=t.params.id,i=r.collectingAnswers.map((function(e){return e.toString()})).indexOf(s),i>-1&&(r.collectingAnswers.splice(i,1),r.save()),t.body=new f({code:204});case 7:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),e}();e.exports=new v},788:(e,t,r)=>{var n=r(185),s=n.Schema,i=n.model,a=new s({__v:{type:Number,select:!1},content:{type:String,required:!0},answerer:{type:s.Types.ObjectId,ref:"User",required:!0,select:!1},questionId:{type:String,required:!0},voteCount:{type:Number,required:!0,default:0}},{timestamps:!0});e.exports=i("Answer",a)},834:(e,t,r)=>{var n=r(185),s=n.Schema,i=n.model,a=new s({__v:{type:Number,select:!1},content:{type:String,required:!0},commentator:{type:s.Types.ObjectId,ref:"User",required:!0,select:!1},questionId:{type:String,required:!0},answerId:{type:String,required:!0},rootCommentId:{type:String},replyTo:{type:s.Types.ObjectId,ref:"User"}},{timestamps:!0});e.exports=i("Comment",a)},864:(e,t,r)=>{var n=r(185),s=n.Schema,i=n.model,a=new s({__v:{type:Number,select:!1},title:{type:String,required:!0},description:{type:String},questioner:{type:s.Types.ObjectId,ref:"User",required:!0,select:!1},topics:{type:[{type:s.Types.ObjectId,ref:"Topics"}],select:!1}},{timestamps:!0});e.exports=i("Question",a)},940:(e,t,r)=>{var n=r(370),s=r(548),i=r(761),a=r(390),o=r(765),c=r(537);function u(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=i(e);if(t){var a=i(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return s(this,r)}}var p=o((function e(t){"use strict";c(this,e);var r=t.data,n=t.msg;"string"==typeof r&&(this.msg=r,a("data"),a("msg")),r&&(this.data=r),n&&(this.msg=n)})),d=function(e){"use strict";n(r,e);var t=u(r);function r(e){var n;c(this,r);e.data,e.msg;var s=e.code;return(n=t.call(this,e)).code=s||200,n}return o(r)}(p),l=function(e){"use strict";n(r,e);var t=u(r);function r(e){var n;c(this,r);e.data,e.msg;var s=e.code,i=e.err;return(n=t.call(this,e)).code=s||404,n.err=i||"",n}return o(r)}(p);e.exports={SuccessModel:d,ErrorModel:l}},323:(e,t,r)=>{var n=r(185),s=n.Schema,i=n.model,a=new s({__v:{type:Number,select:!1},name:{type:String,required:!0},avatar_url:{type:String},introduction:{type:String,select:!1}},{timestamps:!0});e.exports=i("Topics",a)},67:(e,t,r)=>{var n=r(185),s=n.Schema,i=n.model,a=new s({__v:{type:Number,select:!1},name:{type:String,required:!0},age:{type:Number,required:!1,default:0},password:{type:String,required:!0,select:!1},avatar_url:{type:String},gender:{type:String,enum:["male","female","unknow"],default:"unknow",required:!0},headline:{type:String},locations:{type:[{type:s.Types.ObjectId,ref:"Topics"}],select:!1},business:{type:s.Types.ObjectId,ref:"Topics",select:!1},employments:{type:[{company:{type:s.Types.ObjectId,ref:"Topics"},job:{type:s.Types.ObjectId,ref:"Topics"}}],select:!1},educations:{type:[{school:{type:s.Types.ObjectId,ref:"Topics"},major:{type:s.Types.ObjectId,ref:"Topics"},diploma:{type:Number,enum:[1,2,3,4,5]},entrance_year:{type:Number},graduation_year:{type:Number}}],select:!1},introduction:{type:String},following:{type:[{type:s.Types.ObjectId,ref:"User"}],select:!1},followingTopics:{type:[{type:s.Types.ObjectId,ref:"Topics"}],select:!1},likingAnswers:{type:[{type:s.Types.ObjectId,ref:"Answer"}],select:!1},disLikingAnswers:{type:[{type:s.Types.ObjectId,ref:"Answer"}],select:!1},collectingAnswers:{type:[{type:s.Types.ObjectId,ref:"Answer"}],select:!1}},{timestamps:!0});e.exports=i("User",a)},211:(e,t,r)=>{var n=r(752)(),s=r(419),i=r(94),a=s({secret:r(326).secret});n.prefix("/question/:questionId/answer"),n.get("/",i.find),n.post("/",a,i.create),n.get("/:id",i.checkAnswerExist,i.findById),n.patch("/:id",a,i.checkAnswerExist,i.checkAnswerer,i.update),n.delete("/:id",a,i.checkAnswerExist,i.checkAnswerer,i.delete),e.exports=n},616:(e,t,r)=>{var n=r(752)(),s=r(419),i=r(365),a=s({secret:r(326).secret});n.prefix("/question/:questionId/answer/:answerId/comments"),n.get("/",i.find),n.post("/",a,i.create),n.get("/:id",i.checkCommentExist,i.findById),n.patch("/:id",a,i.checkCommentExist,i.checkCommentator,i.update),n.delete("/:id",a,i.checkCommentExist,i.checkCommentator,i.delete),e.exports=n},25:(e,t,r)=>{var n=r(752)(),s=r(334);n.post("/upload",s.upload),e.exports=n},529:(e,t,r)=>{var n=r(307),s=r(591),i=r(752)();i.get("/",function(){var e=s(n.mark((function e(t,r){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.render("index",{title:"https://uat-hd.aihuishou.com/open-item?itemid=Q20221026348301&from=ksapp&traceid=NkZ-ao6PRD4*NkZ-ao6PRD4*KgmDO310bRk*1*W90OJVsZXGM*8*5.6.13*12*23*ext*1657248895691*serverExpTag*kpn*kpf*extType"});case 2:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()),i.get("/string",function(){var e=s(n.mark((function e(t,r){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.body="koa2 string";case 1:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()),i.get("/json",function(){var e=s(n.mark((function e(t,r){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.body={title:"koa2 json"};case 1:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()),e.exports=i},83:(e,t,r)=>{var n=r(752)(),s=r(419),i=r(764),a=r(326).secret,o=r(940),c=(o.SuccessModel,o.ErrorModel,s({secret:a}));n.prefix("/question"),n.get("/",i.find),n.post("/",c,i.create),n.get("/:id",i.checkQuestionExist,i.findById),n.patch("/:id",c,i.checkQuestionExist,i.checkQuestioner,i.update),n.delete("/:id",c,i.checkQuestionExist,i.checkQuestioner,i.delete),e.exports=n},104:(e,t,r)=>{var n=r(752)(),s=r(419),i=r(997),a=r(326).secret,o=r(940),c=(o.SuccessModel,o.ErrorModel,s({secret:a}));n.prefix("/topics"),n.get("/",i.find),n.post("/",c,i.create),n.get("/:id",i.checkTopicExist,i.findById),n.patch("/:id",c,i.checkTopicExist,i.update),n.get("/:id/followers",i.checkTopicExist,i.listTopicFollowers),n.get("/:id/questions",i.checkTopicExist,i.listQuestions),e.exports=n},56:(e,t,r)=>{r(307),r(591);var n=r(419),s=r(326).secret,i=r(997),a=r(752)(),o=r(226),c=r(94),u=r(940),p=(u.SuccessModel,u.ErrorModel,n({secret:s}));a.prefix("/users"),a.get("/",(function(e,t){e.body="this is a users response!"})),a.post("/create",o.create),a.get("/find",o.find),a.get("/findById/:id",o.findById),a.patch("/update/:id",p,o.checkOwner,o.update),a.delete("/delete/:id",p,o.checkOwner,o.delete),a.post("/login",o.login),a.get("/:id/following",o.checkUserExist,o.listFollowing),a.get("/:id/followers",o.checkUserExist,o.listFollowers),a.put("/following/:id",p,o.checkUserExist,o.follow),a.delete("/following/:id",p,o.checkUserExist,o.unfollow),a.put("/following-topics/:id",p,i.checkTopicExist,o.followTopic),a.delete("/following-topics/:id",p,i.checkTopicExist,o.unfollowTopic),a.get("/:id/following-topics",o.checkUserExist,o.listFollowingTopics),a.get("/:id/questions",o.listQuestions),a.get("/:id/liking-answer",o.listLikingAnswers),a.put("/liking-answer/:id",p,c.checkAnswerExist,o.likeAnswer,o.undislikeAnswer),a.delete("/liking-answer/:id",p,c.checkAnswerExist,o.unlikeAnswer),a.get("/:id/disliking-answer",o.listDislikingAnswers),a.put("/disliking-answer/:id",p,c.checkAnswerExist,o.dislikeAnswer,o.unlikeAnswer),a.delete("/disliking-answer/:id",p,c.checkAnswerExist,o.undislikeAnswer),a.get("/:id/collect-answer",o.listCollectingAnswers),a.put("/collect-answer/:id",p,c.checkAnswerExist,o.collectAnswer),a.delete("/collect-answer/:id",p,c.checkAnswerExist,o.uncollectAnswer),e.exports=a},591:e=>{"use strict";e.exports=require("@babel/runtime/helpers/asyncToGenerator")},537:e=>{"use strict";e.exports=require("@babel/runtime/helpers/classCallCheck")},765:e=>{"use strict";e.exports=require("@babel/runtime/helpers/createClass")},779:e=>{"use strict";e.exports=require("@babel/runtime/helpers/defineProperty")},761:e=>{"use strict";e.exports=require("@babel/runtime/helpers/getPrototypeOf")},370:e=>{"use strict";e.exports=require("@babel/runtime/helpers/inherits")},548:e=>{"use strict";e.exports=require("@babel/runtime/helpers/possibleConstructorReturn")},390:e=>{"use strict";e.exports=require("@babel/runtime/helpers/readOnlyError")},307:e=>{"use strict";e.exports=require("@babel/runtime/regenerator")},974:e=>{"use strict";e.exports=require("debug")},344:e=>{"use strict";e.exports=require("jsonwebtoken")},406:e=>{"use strict";e.exports=require("koa")},4:e=>{"use strict";e.exports=require("koa-body")},105:e=>{"use strict";e.exports=require("koa-json")},419:e=>{"use strict";e.exports=require("koa-jwt")},964:e=>{"use strict";e.exports=require("koa-logger")},551:e=>{"use strict";e.exports=require("koa-onerror")},889:e=>{"use strict";e.exports=require("koa-parameter")},752:e=>{"use strict";e.exports=require("koa-router")},97:e=>{"use strict";e.exports=require("koa-static")},783:e=>{"use strict";e.exports=require("koa-views")},185:e=>{"use strict";e.exports=require("mongoose")},685:e=>{"use strict";e.exports=require("http")},17:e=>{"use strict";e.exports=require("path")}},t={};function r(n){var s=t[n];if(void 0!==s)return s.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,r),i.exports}(()=>{var e=r(432),t=r(974)("demo:server"),n=r(685);console.log(process.env.PORT,"process.env.PORT");var s=function(e){var t=parseInt(e,10);if(isNaN(t))return e;if(t>=0)return t;return!1}(process.env.PORT||"9001"),i=n.createServer(e.callback());i.listen(s),i.on("error",(function(e){if("listen"!==e.syscall)throw e;var t="string"==typeof s?"Pipe "+s:"Port "+s;switch(e.code){case"EACCES":console.error(t+" requires elevated privileges"),process.exit(1);break;case"EADDRINUSE":console.error(t+" is already in use"),process.exit(1);break;default:throw e}})),i.on("listening",(function(){var e=i.address(),r="string"==typeof e?"pipe "+e:"port "+e.port;t("Listening on "+r)}))})()})();